# Gomorrah Stealer

Gomorrah Stealer was first seen being sold as early as February 24, 2020 on HackForums, Sinisterly, and SkyNetZone for $200.

In this blog post we will look at the malware through Dynamic Analysis from the [**any.run platform.**](https://any.run/)

https://app.any.run/tasks/97b473b6-a4ce-4a14-a191-f83a0c3a273e/

https://www.virustotal.com/gui/file/18db348d2bc13a33da2eb37da197acc9072aab8a006ee052e5bfbc57ffc99cee/detection

MD5: [**62f7d5d6a9a25543c94d7dc3e2cbc79f**](https://www.virustotal.com/gui/file/18db348d2bc13a33da2eb37da197acc9072aab8a006ee052e5bfbc57ffc99cee/details)

SHA-1: b90bb819d7aa5bfe8ef6ab9df4136bfb6c3abc7c

SHA-256: 18db348d2bc13a33da2eb37da197acc9072aab8a006ee052e5bfbc57ffc99cee 

## Delivery
We cannot say for certain what the delivery mechanism was but it was most likely a phishing message.

## Dynamic Analysis

![Processes](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/1.png)

We start with unk.exe that uses notepad.exe to write amex.exe to the following location:

![amex.exe Properties](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/2.png)

`C:\Users\admin\AppData\Roaming\spgoh\amex.exe`

![VBS File](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/3.png)

MD5: 62f7d5d6a9a25543c94d7dc3e2cbc79f

It also writes a VBS file to maintain persistence to the following location: 

`C:\Users\admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\gn46.vbs`

MD5: 7751fd9a9d905a7cd220040dd73a4b44

gn46.vbs contains the following:

```
SeT bjDAvWcKSU = CreaTEoBJEct("WscRipt.Shell")
 
bJDavwcksU.run """C:\Users\admin\AppData\Roaming\spgoh\amex.exe""", 0, False
```

Next, amex.exe drops a 60 byte portable executable file - FB_D375.tmp.exe - which is a “dud” as [**noted on VT.**](https://www.virustotal.com/gui/file/129450ba06ad589cf6846a455a5b6b5f55e164ee4906e409eb692ab465269689/community)

MD5: [**74bafb3e707c7b0c63938ac200f99c7f**](https://www.virustotal.com/gui/file/129450ba06ad589cf6846a455a5b6b5f55e164ee4906e409eb692ab465269689/details)

Finally, the payload file - FB_D441.tmp.exe - is delivered. It has pretty good detection with 57/72 at the time of writing.  With it being first seen at 2020-04-22 12:12:58 on VirusTotal.

![VT Detections](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/4.png)

VirusTotal History:

![VT History](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/5.png)

We observe that this file has a PDB location of:

`D:\برمجة\Gomorrah\Gomorrah\obj\Debug\Gomorrah.pdb`

![EXIF Data](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/6.png)

As well as the following EXIF data - this will be helpful for detection and retro hunting later on:

```
AssemblyVersion: 1.0.0.0
ProductVersion: 1.0.0.0
ProductName: Gomorrah
OriginalFileName: Gomorrah.exe
LegalCopyright: Copyright © 2020
InternalName: Gomorrah.exe
FileVersion: 1.0.0.0
FileDescription: Gomorrah
CharacterSet: Unicode
LanguageCode: Neutral
FileSubtype: 0
ObjectFileType: Executable application
FileOS: Win32
FileFlags: (none)
FileFlagsMask: 0x003f
ProductVersionNumber: 1.0.0.0
FileVersionNumber: 1.0.0.0
Subsystem: Windows GUI
SubsystemVersion: 6
ImageVersion: 0
OSVersion: 4
EntryPoint: 0x126fe
UninitializedDataSize: 0
InitializedDataSize: 16384
CodeSize: 67584
LinkerVersion: 11
PEType: PE32
TimeStamp: 2020:03:16 13:39:42+01:00
MachineType: Intel 386 or later, and compatibles
```

MD5: [**2fd45662e3d0ec0077ea2fa66b6378f0**](https://www.virustotal.com/gui/file/93d03c6d0c24ce480a06e77c84b33e0bbc0d606fd055ef7cedf772db05c7891d/detection)

FB_D441.tmp.exe writes another portable executable file to the location below. It has the same hash as FB_D441.tmp.exe

`C:\Users\admin\AppData\Local\Temp\cc3a68ce1dad95ce662e1c51f1568e3a.exe`

We observed that the stealer begins to collect data about the computer and passwords stored in the following applications:
FireFox, Chrome, and Outlook

![Modified Files](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/7.png)

C:\Users\admin\AppData\Local\Temp\info.txt

![info.txt](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/8.png)

C:\Users\admin\AppData\Local\Temp\Passwords.txt

![Passwords.txt](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/9.png)

C:\Users\admin\AppData\Local\Temp\Outlook-Passwords.txt

![Outlook-Passwords](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/10.png)

Finally, a screenshot is taken and written to:
C:\Users\admin\AppData\Local\Temp\2020-04-23-04-13-screenshot.png

![2020-04-23-04-13-screenshot.png](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/11.png)

We observed a registry key being written to help maintain persistence.

Key:
`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`

Name:
`Windows Defender Updater`

Value:
`C:\Users\admin\AppData\Local\Temp\cc3a68ce1dad95ce662e1c51f1568e3a.exe / start`

![Registry Persistence](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/12.png)

## Exfiltration

We observe the malware making network connections to exfiltrate the files that were created earlier with the computer information, passwords, and screenshot.  They are sent over HTTP to the C2 domain florapansiyonotel[.]com.  We identified similar data between Gomorrah and Lucifer network traffic. 

hXXp://florapansiyonotel[.]com/images/jaf3//logs.php?hwid=1F8BFBFF000506E3

hXXp://florapansiyonotel[.]com/images/jaf3//gate.php?hwid=1F8BFBFF000506E3

hXXp://florapansiyonotel[.]com/images/jaf3/photos.php?hwid=1F8BFBFF000506E3

Snippet of network traffic:

![Network Traffic](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/13.png)

![Network Traffic](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/14.png)

![Network Traffic](/20200508_Gomorrah_Stealer/Dynamic_Analysis/images/15.png)


## Persistence

C:\Users\admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\gn46.vbs

HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run

## MITRE ATT&CK Framework Mapping

[**T1204 - User Execution**](https://attack.mitre.org/techniques/T1204/)

[**T1060 - Registry Run Keys / Startup Folder**](https://attack.mitre.org/techniques/T1060/)

[**T1081 - Credentials in Files**](https://attack.mitre.org/techniques/T1081/)

[**T1005 - Data from Local System**](https://attack.mitre.org/techniques/T1005/)

[**T1114 - Email Collection**](https://attack.mitre.org/techniques/T1114/)

[**T1113 - Screen Capture**](https://attack.mitre.org/techniques/T1113/)

[**T1043 - Commonly Used Port**](https://attack.mitre.org/techniques/T1043/)

[**T1102 - Web Service**](https://attack.mitre.org/techniques/T1102/)

[**T1041 - Exfiltration Over Command and Control Channel**](https://attack.mitre.org/techniques/T1041/)

## YARA (Detection and Retro Hunting)

We noticed that other samples had “Gomorrah” in the EXIF metadata of the malware making it trivial to identify other Gomorrah samples.  

Searching for behavior:"Gomorrah" produced 82 samples on VirusTotal with the earliest being 2020-02-23 19:15:22.

We have also provided the following YARA Rules:
```
import "pe"
    rule Gomarrah_strings
    {
    strings:
            $text0 = "Gomarrah" wide ascii
       $text1 = "info.txt" wide ascii
       $text2 = "Passwords.txt" wide ascii
       $text3 = "CC.txt" wide ascii
       $text4 = "Outlook-Passwords.txt" wide ascii
        
condition:
            all of them
    }
```

```
import "pe"
rule Gomarrah_PE_Description
{
        pe.version_info ["FileDescription"] contains "Gomarrah"
        $text0 = "Gomarrah" wide ascii
    condition:
        all of them
}
```

## IOCs

Domain(s):

florapansiyonotel[.]com

URL(s):

hXXp://florapansiyonotel[.]com/images/jaf3//logs.php?hwid=1F8BFBFF000506E3

hXXp://florapansiyonotel[.]com/images/jaf3//gate.php?hwid=1F8BFBFF000506E3

hXXp://florapansiyonotel[.]com/images/jaf3/photos.php?hwid=1F8BFBFF000506E3

IP Address(es):

185[.]81.153.102

Network Traffic:

-------------Created By Lucifer [ https://t.me/th3darkly ]-------------

--- Dev By https://t.me/@th3darkly ---

## Credits
The following people contributed to the analysis of this sample:

[**mattdep_**](https://twitter.com/mattdep_)

[**zoomequipd**](https://twitter.com/zoomequipd)

[**_Romans6_**](https://twitter.com/_Romans6_)

[**leabhart**](https://twitter.com/leabhart)

[**morbitcuriosity**](https://twitter.com/morbitcuriosity)

[**IAEspy**](https://twitter.com/IAEspy)

[**CC_DKP**](https://twitter.com/CC_DKP)

